import{t as p,a as m}from"../chunks/CghSzh9C.js";import{p as xe,s as g,u as X,f as Ce,g as n,i as t,j as i,k as c,r,l as H,t as J}from"../chunks/BHUsKUmi.js";import{d as De,s as w}from"../chunks/CqqEqyuc.js";import{p as o,i as L}from"../chunks/ZOBCVC-6.js";import{b as Y,e as Z,i as $}from"../chunks/Bvb1pl9Y.js";import{r as ee,s as ae,a as Le}from"../chunks/D1hb-OSk.js";import{f as Pe,u as te,a as Ae,b as se,c as Ge,d as Ie,n as Te,e as je,g as Be}from"../chunks/CmaycYwG.js";import{G as Fe}from"../chunks/CT4i67Up.js";var Ne=(u,d)=>{n(d,1)},Re=p('<input placeholder="filter by username" class="svelte-13dyhiq"> <button>Add Friends</button>',1),ze=(u,d)=>{n(d,0)},Ee=p('<input placeholder="search by username" class="svelte-13dyhiq"> <button>Back</button>',1),He=(u,d,l)=>d(u,l()),Je=(u,d,l)=>d(u,l()),Ke=p('<a class="svelte-13dyhiq"><div class="user_info svelte-13dyhiq"><button class="rem_friend svelte-13dyhiq">Remove friend</button> <button> </button> <div class="nickname svelte-13dyhiq"> </div> <div class="username svelte-13dyhiq"> </div></div></a>'),Me=p('<div class="result_count svelte-13dyhiq"> </div> <!>',1),Oe=(u,d,l)=>d(u,l()),Qe=p('<button class="add_friend svelte-13dyhiq">Add friend</button>'),Se=p('<a class="svelte-13dyhiq"><div class="user_info svelte-13dyhiq"><!> <div class="nickname svelte-13dyhiq"> </div> <div class="username svelte-13dyhiq"> </div></div></a>'),Ue=p('<div class="result_count svelte-13dyhiq"> </div> <!>',1),Ve=p('<div class="chat_area svelte-13dyhiq"><!></div>'),We=p('<div class="page svelte-13dyhiq"><div class="actions_bar svelte-13dyhiq"><!> <!></div> <div class="list_area svelte-13dyhiq"><!> <!></div> <!></div>');function ia(u,d){xe(d,!0);let l=g(o([]));function K(e){var a;return(a=t(l).find(s=>s.user_id===e))==null?void 0:a.chat_id}function ie(e,a){return t(l).find(s=>s.user_id===e).chat_id=a}function re(e){const a=K(e);return Te.chat_ids.includes(a)}let x=g(0),P=g(""),A=g(""),b=g(o([])),F=g(o([])),C=g(o([]));async function ne(){const e=await Ae(t(A));e.length>0?n(C,o(await te(e))):n(C,o([]))}async function _e(){const{success:e,message:a,list:s}=await Pe();if(e){const _=s.map(v=>v.user_id);_.length>0?n(b,o(await te(_))):n(b,o([])),n(l,o(s))}}_e();let N=null;function oe(e){N&&clearTimeout(N),N=setTimeout(()=>{e(),N=null},500)}X(()=>{if(console.log("value_filter",t(P)),!t(P)){n(F,o(t(b)));return}const e=t(P).toLowerCase();n(F,o(t(b).filter(a=>a.username.toLowerCase().includes(e)|a.nickname.toLowerCase().includes(e))))}),X(()=>{console.log("value_search",t(A)),t(A).length>0?oe(ne):n(C,o([]))});function ce(e){return e!==je.id&&!t(b).find(a=>a._id===e)}async function le(e,a){e.stopPropagation(),e.preventDefault(),await Be(a);const s=t(C).find(_=>_._id===a);t(b).push(s),t(l).push({user_id:s._id,chat_id:null})}async function de(e,a){e.stopPropagation(),e.preventDefault(),await Ge(a),t(b).splice(t(b).findIndex(s=>s._id===a),1),t(l).splice(t(l).findIndex(s=>s.user_id===a),1)}let G=g(null);async function ve(e,a){e.stopPropagation(),e.preventDefault();const s=K(a);if(s)n(G,o(s));else{const{success:_,message:v,id:D}=await Ie(a);_&&(n(G,o(D)),ie(a,D))}}async function ue(){n(G,null)}var M=We(),O=i(M),V=i(O);{var fe=e=>{var a=Re(),s=H(a);ee(s);var _=c(s,2);_.__click=[Ne,x],Y(s,()=>t(P),v=>n(P,v)),m(e,a)};L(V,e=>{t(x)===0&&e(fe)})}var he=c(V,2);{var me=e=>{var a=Ee(),s=H(a);ee(s);var _=c(s,2);_.__click=[ze,x],Y(s,()=>t(A),v=>n(A,v)),m(e,a)};L(he,e=>{t(x)===1&&e(me)})}r(O);var Q=c(O,2),W=i(Q);{var pe=e=>{var a=Me(),s=H(a),_=i(s);r(s);var v=c(s,2);Z(v,17,()=>t(F),$,(D,y)=>{let f=()=>t(y)._id,S=()=>t(y).username,U=()=>t(y).nickname;var h=Ke(),I=i(h),T=i(I);T.__click=[He,de,f];var k=c(T,2);k.__click=[Je,ve,f];var j=i(k,!0);r(k);var B=c(k,2),R=i(B,!0);r(B);var z=c(B,2),q=i(z,!0);r(z),r(I),r(h),J((E,qe,we)=>{ae(h,"href",E),Le(k,`${qe??""} svelte-13dyhiq`),w(j,we),w(R,U()),w(q,S())},[()=>se(`/posts?id=${f()}`),()=>"btn_chat"+(re(f())?" btn_chat_notif":""),()=>K(f())?"Chat":"New Chat"]),m(D,h)}),J(()=>w(_,`results: ${t(F).length??""}`)),m(e,a)};L(W,e=>{t(x)===0&&e(pe)})}var be=c(W,2);{var ge=e=>{var a=Ue(),s=H(a),_=i(s);r(s);var v=c(s,2);Z(v,17,()=>t(C),$,(D,y)=>{let f=()=>t(y)._id,S=()=>t(y).username,U=()=>t(y).nickname;var h=Se(),I=i(h),T=i(I);{var k=q=>{var E=Qe();E.__click=[Oe,le,f],m(q,E)};L(T,q=>{ce(f())&&q(k)})}var j=c(T,2),B=i(j,!0);r(j);var R=c(j,2),z=i(R,!0);r(R),r(I),r(h),J(q=>{ae(h,"href",q),w(B,U()),w(z,S())},[()=>se(`/posts?id=${f()}`)]),m(D,h)}),J(()=>w(_,`results: ${t(C).length??""}`)),m(e,a)};L(be,e=>{t(x)===1&&e(ge)})}r(Q);var ye=c(Q,2);{var ke=e=>{var a=Ve(),s=i(a);Fe(s,{get chat_id(){return t(G)},onclick_close:ue}),r(a),m(e,a)};L(ye,e=>{t(G)!==null&&e(ke)})}r(M),m(u,M),Ce()}De(["click"]);export{ia as component};
