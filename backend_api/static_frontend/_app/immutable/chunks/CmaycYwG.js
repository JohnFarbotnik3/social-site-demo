import{g as b,b as p}from"./DbOWqKF8.js";import{p as l}from"./ZOBCVC-6.js";function v(e){return p+e}function O(e){b(p+e)}function c(e,o){const s=`${new URL(location).origin}${e}`,t={method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)};return fetch(s,t)}const n=l({id:null,token:null,username:null,password:null,nickname:null});function h(){return!!n.token}async function D(e,o,s){const a=await(await c("/account/create",{username:e,nickname:s,password:o})).json();if(console.log("response_body",a),a.success){const{id:r,token:i,nickname:y}=a;return n.id=r,n.token=i,n.username=e,n.nickname=y,{success:a.success,message:null}}else return{success:a.success,message:a.message}}async function I(e,o){const t=await(await c("/account/login",{username:e,password:o})).json();if(console.log("response_body",t),t.success){const{id:a,token:r,nickname:i}=t;return n.id=a,n.token=r,n.username=e,n.nickname=i,{success:t.success,message:null}}else return{success:t.success,message:t.message}}async function S(){const o=await(await c("/account/logout",{user_id:n.id,token_hash:n.token})).json();console.log("response_body",o);for(const[s,t]of Object.entries(n))n[s]=null;return{success:o.success,message:o.message}}async function T(e){const s=await(await c("/account/update_t",{user_id:n.id,token_hash:n.token,props:e})).json();if(console.log("response_body",s),s.success)for(const[t,a]of Object.entries(e))n[t]=a;return{success:s.success,message:s.message}}async function x(e,o){const t=await(await c("/account/update_p",{user_id:n.id,password:o,props:e})).json();if(console.log("response_body",t),t.success)for(const[a,r]of Object.entries(e))n[a]=r;return{success:t.success,message:t.message}}async function F(e){const s=await(await c("/users/public",{user_ids:e})).json();return console.log("response_body",s),s.user_infos}async function N(e){const s=await(await c("/users/search",{search_str:e})).json();return console.log("response_body",s),s.user_ids}async function R(e,o){const t=await(await c("/posts/update",{user_id:n.id,token_hash:n.token,post_id:e,content:o})).json();return console.log("response_body",t),{success:t.success,message:t.message}}async function q(e){const s=await(await c("/posts/get",{post_ids:e})).json();return console.log("response_body",s),s.posts}async function E(){const o=await(await c("/friends/list",{user_id:n.id,token_hash:n.token})).json();return console.log("response_body",o),o.success?{success:o.success,list:o.list}:{success:o.success,message:o.message}}async function L(e){const s=await(await c("/friends/insert",{user_id:n.id,token_hash:n.token,friend_id:e})).json();return console.log("response_body",s),{success:s.success,message:s.message}}async function P(e){const s=await(await c("/friends/remove",{user_id:n.id,token_hash:n.token,friend_id:e})).json();return console.log("response_body",s),{success:s.success,message:s.message}}async function $(e){const s=await(await c("/friends/newchat",{user_id:n.id,token_hash:n.token,friend_id:e})).json();return console.log("response_body",s),s.success?{success:s.success,id:s.id}:{success:s.success,message:s.message}}async function A(e){const s=await(await c("/chats/get",{user_id:n.id,token_hash:n.token,chat_id:e})).json();return console.log("response_body",s),s.success?{success:s.success,chat:s.chat}:{success:s.success,message:s.message}}async function C(e,o){const t=await(await c("/chats/add_post",{user_id:n.id,token_hash:n.token,chat_id:e,content:o})).json();return console.log("response_body",t),t.success?{success:t.success,id:t.id}:{success:t.success,message:t.message}}async function J(e){const s=await(await c("/blogs/insert",{user_id:n.id,token_hash:n.token,content:e})).json();return console.log("response_body",s),s.success?{success:s.success,id:s.id}:{success:s.success,message:s.message}}async function U(e){const s=await(await c("/blogs/remove",{user_id:n.id,token_hash:n.token,post_id:e})).json();return console.log("response_body",s),{success:s.success,message:s.message}}async function W(e){const s=await(await c("/blogs/list",{blog_id:e})).json();return console.log("response_body",s),s.post_ids}const u=l({chat_ids:[]}),g=5*1e3,w=1*1e3;let f=Date.now(),_=g,d=Date.now();setInterval(async()=>{h()&&Date.now()>f+_&&await m()},250);async function m(){const o=await(await c("/notifs/get/chat",{user_id:n.id,token_hash:n.token,clear:!0})).json();console.log("response_body",o);const{success:s,chat_ids:t}=o,a=new Set(u.chat_ids);for(const i of t)a.add(i);u.chat_ids=[...a.keys()];const r=Date.now();f=r,t.length>0?(_=w,d=r+30*1e3):r>d&&(_=g)}function z(e){u.chat_ids=u.chat_ids.filter(o=>o!==e)}export{N as a,v as b,P as c,$ as d,n as e,E as f,L as g,D as h,O as i,I as j,W as k,h as l,R as m,u as n,J as o,q as p,U as q,S as r,T as s,x as t,F as u,z as v,A as w,C as x};
