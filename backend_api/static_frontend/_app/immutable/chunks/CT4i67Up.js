import{t as S,a as G}from"./CghSzh9C.js";import{p as F,s as j,u as H,j as r,k as n,r as c,t as I,g as w,i as t,f as J}from"./BHUsKUmi.js";import{d as K,r as L,s as z}from"./CqqEqyuc.js";import{e as N,b as O,i as P}from"./Bvb1pl9Y.js";import{b as Q,a as R}from"./D1hb-OSk.js";import{p as b}from"./ZOBCVC-6.js";import{r as T}from"./orL9fZk6.js";import{o as U}from"./Bi5T2q8p.js";import{e as V,n as W,v as X,w as Y,u as Z,p as $,x as tt}from"./CmaycYwG.js";async function et(k,e,_,l,v){const{success:o,message:u,id:f}=await tt(e.chat_id,t(_));o&&t(l).push({_id:f,user_id:v,content:t(_),created:Date.now(),updated:Date.now()})}var at=S('<div><div class="name svelte-jzf3db"> </div> <p class="body svelte-jzf3db"> </p> <div class="date svelte-jzf3db"> </div></div>'),st=S('<div><button id="close" class="svelte-jzf3db">Close</button> <div class="post_area svelte-jzf3db"></div> <div class="text_area svelte-jzf3db"><textarea class="svelte-jzf3db"></textarea> <button class="svelte-jzf3db">Send</button></div></div>');function ut(k,e){F(e,!0);const _=T(e,["$$slots","$$events","$$legacy","chat_id","onclick_close"]),l=V.id;let v=j(b(new Map)),o=j(b([])),u=j("");async function f(){const{success:a,message:s,chat:i}=await Y(e.chat_id);if(console.log("chat",i),a){const d=await Z(i.user_ids);w(v,b(new Map(d.map(m=>[m.id,m.nickname])))),w(o,b(await $(i.post_ids)))}}H(()=>f()),U(()=>{const a=setInterval(()=>{W.chat_ids.includes(e.chat_id)&&f().then(()=>X(e.chat_id))},100);return()=>clearInterval(a)});var p=st();let y;var D=r(p);D.__click=function(...a){var s;(s=e.onclick_close)==null||s.apply(this,a)};var h=n(D,2);N(h,21,()=>t(o),P,(a,s)=>{var i=at(),d=r(i),m=r(d,!0);c(d);var g=n(d,2),A=r(g,!0);c(g);var C=n(g,2),B=r(C,!0);c(C),c(i),I(E=>{R(i,`${"post"+(t(s).user_id===l?" post_me":"")} svelte-jzf3db`),z(m,E),z(A,t(s).content),z(B,new Date(t(s).updated))},[()=>t(v).get(t(s).user_id)]),G(a,i)}),c(h);var M=n(h,2),x=r(M);L(x);var q=n(x,2);q.__click=[et,e,u,o,l],c(M),c(p),I(()=>y=Q(p,y,{class:"outer",..._},"svelte-jzf3db")),O(x,()=>t(u),a=>w(u,a)),G(k,p),J()}K(["click"]);export{ut as G};
